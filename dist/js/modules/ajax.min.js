/* Tabulator v4.9.1 (c) Oliver Folkerd */
var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ajax=function(t){this.table=t,this.config=!1,this.url="",this.urlGenerator=!1,this.params=!1,this.loaderPromise=!1,this.progressiveLoad=!1,this.loading=!1,this.requestOrder=0};Ajax.prototype.initialize=function(){this.loaderPromise=this.table.options.ajaxRequestFunc||this.defaultLoaderPromise,this.urlGenerator=this.table.options.ajaxURLGenerator||this.defaultURLGenerator,this.table.options.ajaxParams&&this.setParams(this.table.options.ajaxParams),this.table.options.ajaxConfig&&this.setConfig(this.table.options.ajaxConfig),this.table.options.ajaxURL&&this.setUrl(this.table.options.ajaxURL),this.table.options.ajaxProgressiveLoad&&(this.table.options.pagination?(this.progressiveLoad=!1,console.error("Progressive Load Error - Pagination and progressive load cannot be used at the same time")):this.table.modExists("page")?(this.progressiveLoad=this.table.options.ajaxProgressiveLoad,this.table.modules.page.initializeProgressive(this.progressiveLoad)):console.error("Pagination plugin is required for progressive ajax loading"))},Ajax.prototype.initializeQuery=function(t,e){var o=this;return this.loaderPromise(t,this.config,this.params).then(function(t){return o.table.options.dataSource.async.initResponse(t)}).catch(function(t){return t})},Ajax.prototype.getStatus=function(t){var e=this.table;return this.loaderPromise(t,this.config,this.params).then(function(t){return e.options.dataSource.async.statusResponse(t)}).catch(function(t){return t})},Ajax.prototype.getData=function(t){var e=this,o=this.table;return this.loading=!0,this.showLoader(),this.loaderPromise(t,this.config,this.params).then(function(t){return e.hideLoader(),e.loading=!1,o.options.dataSource.async.resultsResponse(t)}).catch(function(t){return e.showError(),setTimeout(function(){this.hideLoader()},3e3),e.loading=!1,t})},Ajax.prototype.getResults=function(t,e){return this._loadDataStandard(t,e)},Ajax.prototype.setParams=function(t,e){if(e){this.params=this.params||{};for(var o in t)this.params[o]=t[o]}else this.params=t},Ajax.prototype.getParams=function(){return this.params||{}},Ajax.prototype.setConfig=function(t){if(this._loadDefaultConfig(),"string"==typeof t)this.config.method=t;else for(var e in t)this.config[e]=t[e]},Ajax.prototype._loadDefaultConfig=function(t){var e=this;if(!e.config||t){e.config={};for(var o in e.defaultConfig)e.config[o]=e.defaultConfig[o]}},Ajax.prototype.setUrl=function(t){this.url=t},Ajax.prototype.getUrl=function(){return this.url},Ajax.prototype.loadData=function(t,e){return this.progressiveLoad?this._loadDataProgressive():this._loadDataStandard(t,e)},Ajax.prototype.nextPage=function(t){var e;this.loading||(e=this.table.options.ajaxProgressiveLoadScrollMargin||2*this.table.rowManager.getElement().clientHeight,t<e&&this.table.modules.page.nextPage().then(function(){}).catch(function(){}))},Ajax.prototype.blockActiveRequest=function(){this.requestOrder++},Ajax.prototype._loadDataProgressive=function(){return this.table.rowManager.setData([]),this.table.modules.page.setPage(1)},Ajax.prototype._loadDataStandard=function(t,e){var o=this;return new Promise(function(a,r){o.sendRequest(t).then(function(n){o.table.rowManager.setData(n,t,e).then(function(){a()}).catch(function(t){r(t)})}).catch(function(t){r(t)})})},Ajax.prototype.generateParamsList=function(t,e){var o=this,a=[];if(e=e||"",Array.isArray(t))t.forEach(function(t,r){a=a.concat(o.generateParamsList(t,e?e+"["+r+"]":r))});else if("object"===(void 0===t?"undefined":_typeof(t)))for(var r in t)a=a.concat(o.generateParamsList(t[r],e?e+"["+r+"]":r));else a.push({key:e,value:t});return a},Ajax.prototype.serializeParams=function(t){var e=this.generateParamsList(t),o=[];return e.forEach(function(t){o.push(encodeURIComponent(t.key)+"="+encodeURIComponent(t.value))}),o.join("&")},Ajax.prototype.sendRequest=function(t){var e,o=this,a=this,r=a.url;return a.requestOrder++,e=a.requestOrder,a._loadDefaultConfig(),new Promise(function(n,i){!1!==a.table.options.ajaxRequesting.call(o.table,a.url,a.params)?(a.loading=!0,t||a.showLoader(),o.loaderPromise(r,a.config,a.params).then(function(t){e===a.requestOrder?(a.table.options.ajaxResponse&&(t=a.table.options.ajaxResponse.call(a.table,a.url,a.params,t)),n(t),a.hideLoader(),a.loading=!1):console.warn("Ajax Response Blocked - An active ajax request was blocked by an attempt to change table data while the request was being made")}).catch(function(t){console.error("Ajax Load Error: ",t),a.table.options.ajaxError.call(a.table,t),a.showError(),setTimeout(function(){a.hideLoader()},3e3),a.loading=!1,i(t)})):i()})},Ajax.prototype.defaultConfig={method:"GET"},Ajax.prototype.defaultURLGenerator=function(t,e,o){return t&&o&&Object.keys(o).length&&(e.method&&"get"!=e.method.toLowerCase()||(e.method="get",t+=(t.includes("?")?"&":"?")+this.modules.ajax.serializeParams(o))),t},Ajax.prototype.defaultLoaderPromise=function(t,e,o){var a,r=this;return new Promise(function(n,i){if(t=r.urlGenerator.call(r.table,t,e,o),"GET"!=e.method.toUpperCase())if(a="object"===_typeof(r.table.options.ajaxContentType)?r.table.options.ajaxContentType:r.contentTypeFormatters[r.table.options.ajaxContentType]){for(var s in a.headers)e.headers||(e.headers={}),void 0===e.headers[s]&&(e.headers[s]=a.headers[s]);e.body=a.body.call(r,t,e,o)}else console.warn("Ajax Error - Invalid ajaxContentType value:",r.table.options.ajaxContentType);t?(void 0===e.headers&&(e.headers={}),void 0===e.headers.Accept&&(e.headers.Accept="application/json"),void 0===e.headers["X-Requested-With"]&&(e.headers["X-Requested-With"]="XMLHttpRequest"),void 0===e.mode&&(e.mode="cors"),"cors"==e.mode?(void 0===e.headers["Access-Control-Allow-Origin"]&&(e.headers["Access-Control-Allow-Origin"]=window.location.origin),void 0===e.credentials&&(e.credentials="same-origin")):void 0===e.credentials&&(e.credentials="include"),fetch(t,e).then(function(t){t.ok?t.json().then(function(t){n(t)}).catch(function(t){i(t),console.warn("Ajax Load Error - Invalid JSON returned",t)}):(console.error("Ajax Load Error - Connection Error: "+t.status,t.statusText),i(t))}).catch(function(t){console.error("Ajax Load Error - Connection Error: ",t),i(t)})):(console.warn("Ajax Load Error - No URL Set"),n([]))})},Ajax.prototype.contentTypeFormatters={json:{headers:{"Content-Type":"application/json"},body:function(t,e,o){return JSON.stringify(o)}},form:{headers:{},body:function(t,e,o){var a=this.generateParamsList(o),r=new FormData;return a.forEach(function(t){r.append(t.key,t.value)}),r}}},Ajax.prototype.showLoader=function(){this.table.overlay.showLoader()},Ajax.prototype.hideLoader=function(){this.table.overlay.hideLoader()},Tabulator.prototype.registerModule("ajax",Ajax);